# 도커를 이용한 로그 생성 및 관리

- 도커는 표준 출력 스트림을 통해 로그를 수집한다.
  > 표준출력(STDOUT): 출력 장치. 일반적으로는 현재 쉘을 실행한 콘솔이나 터미널.

## 표준 에러 스트림과 표준 출력 스트림

- 도커 이미지는 애플리케이션 바이너리 및 의존성, 컨테이너에 대한 프로세스 정보를 담은 파일 시스템 스냅샷이다.
  - 포어그라운드로 동작한다.
    - 입력된 명령이 실행중일 때 I/O를 통제하기 때문에 각 컨테이너의 stdout과 stderr 스트림을 주시하며 출력되는 내용을 수집한다.
- 터미널과 분리된 컨테이너와 종료된 컨테이너의 로그를 수집할 수 있다.
  - JSON파일로도 저장한다.
    - 도커가 직접 컨테이너와 동일한 생애주기를 갖도록 관리한다.
      - 컨테이너가 제거되면 로그도 함께 사라진다.
      - 일반적으로는 파일에 직접 접근할 수 없다.
    - 로그 파일의 크기와 수를 설정할 수 있다.
      - 기본적으로 일괄 적용이지만, 컨테이너 개별로도 적용 가능하다.
      - LRU 방식

## 다른 곳으로 출력된 로그를 stdout 스트림에 전달하기

컨테이너에서 데몬 형태로 동작하는 애플리케이션은 표준 로그 모델을 적용하기 어려운 경우가 있다. (출력 스트림으로 아무 내용도 출력하지 않는 경우)<br/>
이런 경우 `로그 파일을 읽어 표준 출력으로 내보내주는 별도의 프로세스`를 컨테이너 시작 명령에서 실행하면 된다.
<br/>
해당 패턴은 유용하지만 도커 로그 유틸리티가 포어그라운드로 동작한다는 것을 유의해야한다.

<br/><hr/><br/>

`19-3 ~ 19-5`는 EFK스택을 예시로 도커의 중앙 집중식 로그 관리에 대해 설명한다.
<br/><br/>
중앙 집중식 로그가 상용에 더 적합한 이유는

- 로그가 흩어지지 않게 하나의 중앙 시스템으로 수집한다.
  - 중앙화된 로그를 통해 문제 발생 시 여러 로그 소스를 한 번에 조회할 수 있어, 문제의 원인을 빠르게 진단할 수 있습니다.
  - Elasticsearch를 통해 로그 데이터를 빠르고 효율적으로 검색하여 원인을 빠르게 파악할 수 있다.
- Kibana를 통해 로그 데이터를 시각화하고, 트렌드 분석, 대시보드 생성 등을 통해 로그 데이터를 분석할 수 있다.
- 실시간 모니터링 및 리포팅 자동화의 관리 포인트를 줄일 수 있다.
