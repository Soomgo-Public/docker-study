# 도커에 대한 기본 이해 Action Items

## IPC

IPC는 Inter Process Communication의 약자로, 프로세스 간 통신을 가능하게 하는 메커니즘이나 프로토콜을 가리키는 용어이다

### 종류

- 파이프
  > 두 프로세스 간에 단방향 통신을 제공하는 메커니즘입니다. 주로 부모 프로세스와 자식 프로세스 간에 사용.
- 메시지 큐
  > 프로세스 간에 데이터를 `비동기`적으로 전송. 메시지를 큐에 보내고 받는 방식.
  > 생각해보면 채팅 구현할때 자주 접하는 구조인데, 당연했지만, 채팅을 생각해보면 서로 다른 프로세스의 통신이었다..!
- 공유 메모리
  > 두 프로세스가 같은 물리적 메모리 공간을 공유한다.
- 소켓
- 파일
- 시그널
  > UNIX 및 유닉스 기반 시스템에서 사용되는 방법 중 하나.
  > 프로세스에 특정 이벤트 또는 동작을 알리기 위해 사용된다.

<br/>

**_IPC라는 용어가 생소했지만, 생각해보니, 알게 모르게 다른 프로세스간 통신을 위해 이거저거 해봤던것 같다_**

<br />

## Docker Cahcing

<img src="https://github.com/mash-up-kr/moit-web/assets/82315118/b8955b84-b015-4856-90f6-61bde87baa50" alt="" />

### 나의 궁금

```
1. Docker 이미지에 [1,2,3,4,5]의 스크립트가 있고 3번 스크립트에 변경사항이 있다고 가정해보자
2. [3,4,5]만 재실행도 아니고, 3만 재실행하려면 diff를 캐치하는 시스템이 있을텐데 ?
3. 기본으로 제공하는 걸까 ? 아니면 어떤 옵션을 통해 구현이 가능한걸까 ?
4. 구현했다면 어떤 논리일까
```

#### 내 생각이 맞았다.

> 해당 궁금중은 Docker의 공식 문서에 아주 잘 나와 있었다.
> https://docs.docker.com/build/cache

<img src="https://github.com/Soomgo-public/docker-study/assets/82315118/f5a567f2-877e-43ff-b63e-e01834773299" />

<br/>

사진에서 보면 알 수 있듯, Docker는 레이어 단위로 캐싱할 수 있다. 따라서 3이 변경되면, 3에 영향을 받을 4와 5는 무조건적으로 재실행된다.
<br/>
<br/>
즉, 처음 궁금증을 유발한 `only those layers which have changed are rebuilt`는 변화가 있는 레이어만 리빌드된다기 보다는, 해당 레이어부터 새롭게 이미지를 만드는 것으로 해석하는게 맞을듯 하다...

### 결론적으로

Docker의 캐싱을 효과적으로 사용하려면 `Dockerfile`에 스크립트를 작성할 때 몇 가지를 유의해야한다.

- **_스크립트 작성 순서는 논리적으로_**
  > 당연하지만 기존 스크립트에 변경을 주는 내용은 후의 순서로 진행하여 최대한 변화를 덜 발생시키는게 좋다.
- **_Use multi-stage builds_**

  > Dockerfile을 여러 개별 단계로 분할할 수 있다.
  > 각 단계는 빌드 프로세스의 한 단계를 완료하며, 마지막에 여러 단계를 연결하여 최종 이미지를 생성할 수 있다.
  >
  > 해당 분리를 통해 단계 간 종속성을 해결하고, 여러 개의 빌드를 동시에 실행할 수도 있다.
  >
  > multi stage builds는 두 개 이상의 FROM명령을 사용한다.

- **_Docker 명령어를 스크립트 명령과 결합하라_**
  > Docker 대부분의 명령어는 스크립트 명령어와 함께쓸 수 있다. 특히 `RUN` 명령어는 스크립트 명령어와 함께쓰면 좋다.
  >
  > **_Bad_**
  >
  > ```
  > RUN echo "the first command"
  > RUN echo "the second command"
  > ```
  >
  > **_Good_**
  >
  > ```
  > RUN echo "the first command" && echo "the second command"
  > ```
  >
  > <br/>
